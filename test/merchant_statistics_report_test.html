<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†æˆ·ä¿¡æ¯ç»Ÿè®¡æŠ¥è¡¨åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #27ae60;
            border-left: 4px solid #27ae60;
            padding-left: 10px;
            margin-top: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fafafa;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
            color: #555;
        }
        input, select, textarea {
            width: 300px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.success {
            background-color: #27ae60;
        }
        button.success:hover {
            background-color: #219a52;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }
        .online {
            background-color: #d4edda;
            color: #155724;
        }
        .offline {
            background-color: #f8d7da;
            color: #721c24;
        }
        .use-case-info {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .chart-container {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: white;
        }
        .stat-card {
            display: inline-block;
            width: 200px;
            margin: 10px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        .report-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .report-table th, .report-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .report-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .report-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š å•†æˆ·ä¿¡æ¯ç»Ÿè®¡æŠ¥è¡¨åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="use-case-info">
            <h3>ğŸ“‹ ç”¨ä¾‹è§„çº¦ä¿¡æ¯</h3>
            <p><strong>ç”¨ä¾‹åç§°ï¼š</strong>å•†æˆ·ä¿¡æ¯ç»Ÿè®¡æŠ¥è¡¨ (2.7.5)</p>
            <p><strong>å‚ä¸è€…ï¼š</strong>ç®¡ç†å‘˜</p>
            <p><strong>ç®€è¦æè¿°ï¼š</strong>ç³»ç»ŸæŒ‰ç§Ÿæˆ·ç±»å‹ã€åº—é¢åŒºåŸŸç­‰ç»´åº¦ç”Ÿæˆå•†æˆ·ç»Ÿè®¡æŠ¥è¡¨</p>
            <p><strong>å‰ç½®æ¡ä»¶ï¼š</strong>
                <br>1. ç³»ç»Ÿå­˜åœ¨å•†æˆ·åŠåº—é¢è®°å½•
                <br>2. ç®¡ç†äººå‘˜å…·å¤‡æŠ¥è¡¨æƒé™
            </p>
            <p><strong>åç½®æ¡ä»¶ï¼š</strong>æŠ¥è¡¨ç”ŸæˆæˆåŠŸ</p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
            <p>APIåœ°å€ï¼š<span id="apiUrl">http://localhost:5263</span> <span id="apiStatus" class="status offline">ç¦»çº¿</span></p>
            <button onclick="checkApiStatus()">æ£€æŸ¥APIçŠ¶æ€</button>
            <div id="statusResult" class="result info"></div>
        </div>

        <!-- åŸºç¡€ç»Ÿè®¡ä»ªè¡¨æ¿ -->
        <div class="test-section">
            <h2>ğŸ“ˆ åŸºç¡€ç»Ÿè®¡ä»ªè¡¨æ¿</h2>
            <p>å¿«é€ŸæŸ¥çœ‹å•†æˆ·å’Œåº—é¢çš„åŸºç¡€ç»Ÿè®¡ä¿¡æ¯</p>
            
            <button onclick="loadBasicStatistics()">åˆ·æ–°åŸºç¡€ç»Ÿè®¡</button>
            
            <div id="statsCards" class="chart-container">
                <!-- ç»Ÿè®¡å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div id="basicStatsResult" class="result info"></div>
        </div>

        <!-- ç»Ÿè®¡æŠ¥è¡¨ç”Ÿæˆ -->
        <div class="test-section">
            <h2>ğŸ“Š ç»Ÿè®¡æŠ¥è¡¨ç”Ÿæˆ</h2>
            
            <div class="form-group">
                <label>æ“ä½œå‘˜è´¦å·:</label>
                <select id="operatorAccount">
                    <option value="admin">admin (ç³»ç»Ÿç®¡ç†å‘˜)</option>
                    <option value="admin_test">admin_test (æµ‹è¯•ç®¡ç†å‘˜)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>ç»Ÿè®¡ç»´åº¦:</label>
                <select id="statisticsDimension">
                    <option value="all">å…¨éƒ¨ç»Ÿè®¡</option>
                    <option value="type">æŒ‰ç§Ÿæˆ·ç±»å‹</option>
                    <option value="area">æŒ‰åº—é¢åŒºåŸŸ</option>
                    <option value="status">æŒ‰åº—é¢çŠ¶æ€</option>
                </select>
            </div>
            
            <div style="margin: 15px 0;">
                <button onclick="generateReport()">ç”Ÿæˆç»Ÿè®¡æŠ¥è¡¨</button>
                <button onclick="exportReport()" class="success">å¯¼å‡ºæŠ¥è¡¨</button>
            </div>
            
            <div id="reportResult" class="result info"></div>
        </div>

        <!-- ä¸“é¡¹ç»Ÿè®¡æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ¯ ä¸“é¡¹ç»Ÿè®¡æµ‹è¯•</h2>
            
            <div style="margin: 15px 0;">
                <button onclick="testTypeStatistics()">ç§Ÿæˆ·ç±»å‹ç»Ÿè®¡</button>
                <button onclick="testAreaStatistics()">åŒºåŸŸåˆ†å¸ƒç»Ÿè®¡</button>
                <button onclick="testStatusStatistics()">çŠ¶æ€åˆ†æç»Ÿè®¡</button>
                <button onclick="testRevenueStatistics()">æ”¶å…¥ç»Ÿè®¡åˆ†æ</button>
            </div>
            
            <div id="specialTestResult" class="result info"></div>
        </div>

        <!-- å¼‚å¸¸æƒ…å†µæµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ§ª å¼‚å¸¸æƒ…å†µæµ‹è¯•</h2>
            
            <div style="margin: 15px 0;">
                <button onclick="testUnauthorizedAccess()">æƒé™ä¸è¶³æµ‹è¯•</button>
                <button onclick="testEmptyData()">ç©ºæ•°æ®æµ‹è¯•</button>
                <button onclick="testInvalidDimension()">æ— æ•ˆç»´åº¦æµ‹è¯•</button>
            </div>
            
            <div id="exceptionTestResult" class="result info"></div>
        </div>

        <!-- å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸš€ å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•</h2>
            <p>æµ‹è¯•ä»æ•°æ®æŸ¥è¯¢åˆ°æŠ¥è¡¨ç”Ÿæˆçš„å®Œæ•´æµç¨‹</p>
            
            <button onclick="runCompleteWorkflowTest()">å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•</button>
            <div id="workflowTestResult" class="result info"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5263/api';
        let currentReportData = null;
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥APIçŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
            loadBasicStatistics();
        });
        
        // æ£€æŸ¥APIçŠ¶æ€
        async function checkApiStatus() {
            const statusElement = document.getElementById('apiStatus');
            const resultElement = document.getElementById('statusResult');
            
            try {
                const response = await fetch(`${API_BASE}/Store/AvailableAreas`);
                if (response.ok) {
                    statusElement.textContent = 'åœ¨çº¿';
                    statusElement.className = 'status online';
                    resultElement.textContent = 'âœ… APIè¿æ¥æˆåŠŸï¼';
                    resultElement.className = 'result success';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusElement.textContent = 'ç¦»çº¿';
                statusElement.className = 'status offline';
                resultElement.textContent = `âŒ APIè¿æ¥å¤±è´¥: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // åŠ è½½åŸºç¡€ç»Ÿè®¡æ•°æ®
        async function loadBasicStatistics() {
            const statsCards = document.getElementById('statsCards');
            const resultElement = document.getElementById('basicStatsResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨åŠ è½½åŸºç¡€ç»Ÿè®¡æ•°æ®...';
                resultElement.className = 'result info';
                
                const response = await fetch(`${API_BASE}/Store/BasicStatistics`);
                const data = await response.json();
                
                if (response.ok) {
                    // åˆ›å»ºç»Ÿè®¡å¡ç‰‡
                    statsCards.innerHTML = `
                        <div class="stat-card">
                            <div class="stat-number">${data.totalStores}</div>
                            <div class="stat-label">æ€»åº—é“ºæ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.activeStores}</div>
                            <div class="stat-label">æ­£å¸¸è¥ä¸š</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.vacantAreas}</div>
                            <div class="stat-label">ç©ºç½®åŒºåŸŸ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.occupancyRate}%</div>
                            <div class="stat-label">å…¥ä½ç‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">Â¥${data.averageRent}</div>
                            <div class="stat-label">å¹³å‡ç§Ÿé‡‘</div>
                        </div>
                    `;
                    
                    resultElement.textContent = `âœ… åŸºç¡€ç»Ÿè®¡æ•°æ®åŠ è½½æˆåŠŸ
æ›´æ–°æ—¶é—´: ${new Date().toLocaleString()}`;
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `âŒ åŠ è½½å¤±è´¥: ${data.error || JSON.stringify(data)}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`;
                resultElement.className = 'result error';
                statsCards.innerHTML = '<p>ç»Ÿè®¡æ•°æ®åŠ è½½å¤±è´¥</p>';
            }
        }

        // ç”Ÿæˆç»Ÿè®¡æŠ¥è¡¨
        async function generateReport() {
            const resultElement = document.getElementById('reportResult');
            const operatorAccount = document.getElementById('operatorAccount').value;
            const dimension = document.getElementById('statisticsDimension').value;
            
            try {
                resultElement.textContent = `æ­£åœ¨ç”Ÿæˆ${getDimensionName(dimension)}ç»Ÿè®¡æŠ¥è¡¨...`;
                resultElement.className = 'result info';
                
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=${operatorAccount}&dimension=${dimension}`
                );
                const data = await response.json();
                
                if (response.ok) {
                    currentReportData = data;
                    displayReport(data, resultElement);
                } else {
                    resultElement.textContent = `âŒ æŠ¥è¡¨ç”Ÿæˆå¤±è´¥: ${data.error || JSON.stringify(data)}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // æ˜¾ç¤ºæŠ¥è¡¨æ•°æ®
        function displayReport(reportData, container) {
            let content = `ğŸ“Š ${reportData.reportTitle}
ç”Ÿæˆæ—¶é—´: ${new Date(reportData.generateTime).toLocaleString()}
æ“ä½œå‘˜: ${reportData.operator}
ç»Ÿè®¡ç»´åº¦: ${getDimensionName(reportData.dimension)}

`;

            if (reportData.data.overview) {
                content += `=== æ€»è§ˆç»Ÿè®¡ ===
æ€»åº—é“ºæ•°: ${reportData.data.overview.totalStores}
æ­£å¸¸è¥ä¸š: ${reportData.data.overview.activeStores}
æš‚åœè¥ä¸š: ${reportData.data.overview.inactiveStores}
æ€»åŒºåŸŸæ•°: ${reportData.data.overview.totalAreas}
ç©ºç½®åŒºåŸŸ: ${reportData.data.overview.vacantAreas}
å·²ç§ŸåŒºåŸŸ: ${reportData.data.overview.occupiedAreas}
å…¥ä½ç‡: ${reportData.data.overview.occupancyRate}%
å¹³å‡ç§Ÿé‡‘: Â¥${reportData.data.overview.averageRent}
æ€»æ”¶å…¥: Â¥${reportData.data.overview.totalRevenue}

`;
            }

            // æ˜¾ç¤ºå…·ä½“ç»´åº¦æ•°æ®
            if (reportData.data.title) {
                content += `=== ${reportData.data.title} ===\n`;
                if (reportData.data.summary) {
                    content += `æ‘˜è¦: ${JSON.stringify(reportData.data.summary, null, 2)}\n`;
                }
                if (reportData.data.details) {
                    content += `è¯¦ç»†æ•°æ®:\n${JSON.stringify(reportData.data.details, null, 2)}\n`;
                }
            }

            // å¦‚æœæ˜¯å®Œæ•´æŠ¥è¡¨ï¼Œæ˜¾ç¤ºå„ä¸ªç»´åº¦
            if (reportData.data.byType) {
                content += `\n=== ${reportData.data.byType.title} ===\n`;
                content += `${JSON.stringify(reportData.data.byType, null, 2)}\n`;
            }
            if (reportData.data.byArea) {
                content += `\n=== ${reportData.data.byArea.title} ===\n`;
                content += `${JSON.stringify(reportData.data.byArea, null, 2)}\n`;
            }
            if (reportData.data.byStatus) {
                content += `\n=== ${reportData.data.byStatus.title} ===\n`;
                content += `${JSON.stringify(reportData.data.byStatus, null, 2)}\n`;
            }

            container.textContent = content;
            container.className = 'result success';
        }

        // è·å–ç»´åº¦åç§°
        function getDimensionName(dimension) {
            const names = {
                'all': 'å®Œæ•´',
                'type': 'æŒ‰ç±»å‹',
                'area': 'æŒ‰åŒºåŸŸ',
                'status': 'æŒ‰çŠ¶æ€'
            };
            return names[dimension] || dimension;
        }

        // å¯¼å‡ºæŠ¥è¡¨
        function exportReport() {
            if (!currentReportData) {
                alert('è¯·å…ˆç”ŸæˆæŠ¥è¡¨');
                return;
            }
            
            const content = JSON.stringify(currentReportData, null, 2);
            const blob = new Blob([content], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `merchant_statistics_${currentReportData.dimension}_${new Date().getTime()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æµ‹è¯•ç§Ÿæˆ·ç±»å‹ç»Ÿè®¡
        async function testTypeStatistics() {
            const resultElement = document.getElementById('specialTestResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨æµ‹è¯•ç§Ÿæˆ·ç±»å‹ç»Ÿè®¡...';
                resultElement.className = 'result info';
                
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=admin&dimension=type`
                );
                const data = await response.json();
                
                if (response.ok) {
                    let content = `âœ… ç§Ÿæˆ·ç±»å‹ç»Ÿè®¡æµ‹è¯•æˆåŠŸ!\n\n`;
                    content += `ç»Ÿè®¡ç»´åº¦: ${data.data.title}\n`;
                    content += `ç»Ÿè®¡æ‘˜è¦: ${JSON.stringify(data.data.summary, null, 2)}\n\n`;
                    content += `è¯¦ç»†æ•°æ®:\n`;
                    data.data.details.forEach((item, index) => {
                        content += `${index + 1}. ${item.storeType}: ${item.storeCount}ä¸ªåº—é“º (${item.percentage}%)\n`;
                        content += `   æ€»ç§Ÿé‡‘: Â¥${item.totalRent}, å¹³å‡ç§Ÿé‡‘: Â¥${item.averageRent}\n`;
                        content += `   æ­£å¸¸è¥ä¸š: ${item.activeStores}, å…¶ä»–çŠ¶æ€: ${item.inactiveStores}\n\n`;
                    });
                    
                    resultElement.textContent = content;
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${data.error}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // æµ‹è¯•åŒºåŸŸåˆ†å¸ƒç»Ÿè®¡
        async function testAreaStatistics() {
            const resultElement = document.getElementById('specialTestResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨æµ‹è¯•åŒºåŸŸåˆ†å¸ƒç»Ÿè®¡...';
                resultElement.className = 'result info';
                
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=admin&dimension=area`
                );
                const data = await response.json();
                
                if (response.ok) {
                    let content = `âœ… åŒºåŸŸåˆ†å¸ƒç»Ÿè®¡æµ‹è¯•æˆåŠŸ!\n\n`;
                    content += `ç»Ÿè®¡ç»´åº¦: ${data.data.title}\n`;
                    content += `ç»Ÿè®¡æ‘˜è¦: ${JSON.stringify(data.data.summary, null, 2)}\n\n`;
                    content += `åŒºåŸŸè¯¦æƒ… (å‰10ä¸ª):\n`;
                    data.data.details.slice(0, 10).forEach((area, index) => {
                        content += `${index + 1}. åŒºåŸŸ${area.areaId}: ${area.areaSize}ã¡, ç§Ÿé‡‘Â¥${area.baseRent}\n`;
                        content += `   çŠ¶æ€: ${area.rentStatus}, å·²å ç”¨: ${area.isOccupied ? 'æ˜¯' : 'å¦'}\n`;
                        if (area.storeName) {
                            content += `   åº—é“º: ${area.storeName} (${area.tenantName})\n`;
                            content += `   ç±»å‹: ${area.storeType}, ç§ŸæœŸ: ${area.rentStart} ~ ${area.rentEnd}\n`;
                        }
                        content += '\n';
                    });
                    
                    resultElement.textContent = content;
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${data.error}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // æµ‹è¯•çŠ¶æ€åˆ†æç»Ÿè®¡
        async function testStatusStatistics() {
            const resultElement = document.getElementById('specialTestResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨æµ‹è¯•çŠ¶æ€åˆ†æç»Ÿè®¡...';
                resultElement.className = 'result info';
                
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=admin&dimension=status`
                );
                const data = await response.json();
                
                if (response.ok) {
                    let content = `âœ… çŠ¶æ€åˆ†æç»Ÿè®¡æµ‹è¯•æˆåŠŸ!\n\n`;
                    content += `ç»Ÿè®¡ç»´åº¦: ${data.data.title}\n`;
                    content += `ç»Ÿè®¡æ‘˜è¦: ${JSON.stringify(data.data.summary, null, 2)}\n\n`;
                    content += `çŠ¶æ€åˆ†å¸ƒ:\n`;
                    data.data.details.forEach((status, index) => {
                        content += `${index + 1}. ${status.storeStatus}: ${status.storeCount}ä¸ªåº—é“º (${status.percentage}%)\n`;
                        content += `   å¹³å‡ç§Ÿé‡‘: Â¥${status.averageRent}, æ€»ç§Ÿé‡‘: Â¥${status.totalRent}\n`;
                        content += `   çŠ¶æ€æè¿°: ${status.statusDescription}\n\n`;
                    });
                    
                    resultElement.textContent = content;
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${data.error}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // æµ‹è¯•æ”¶å…¥ç»Ÿè®¡åˆ†æ
        async function testRevenueStatistics() {
            const resultElement = document.getElementById('specialTestResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨æµ‹è¯•æ”¶å…¥ç»Ÿè®¡åˆ†æ...';
                resultElement.className = 'result info';
                
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=admin&dimension=all`
                );
                const data = await response.json();
                
                if (response.ok && data.data.overview) {
                    let content = `âœ… æ”¶å…¥ç»Ÿè®¡åˆ†ææµ‹è¯•æˆåŠŸ!\n\n`;
                    content += `=== æ”¶å…¥æ¦‚è§ˆ ===\n`;
                    content += `æ€»æ”¶å…¥: Â¥${data.data.overview.totalRevenue}\n`;
                    content += `å¹³å‡ç§Ÿé‡‘: Â¥${data.data.overview.averageRent}\n`;
                    content += `æ´»è·ƒåº—é“º: ${data.data.overview.activeStores}ä¸ª\n`;
                    content += `å…¥ä½ç‡: ${data.data.overview.occupancyRate}%\n\n`;
                    
                    if (data.data.byType && data.data.byType.details) {
                        content += `=== å„ç±»å‹æ”¶å…¥åˆ†å¸ƒ ===\n`;
                        data.data.byType.details.forEach(type => {
                            content += `${type.storeType}: Â¥${type.totalRent} (å¹³å‡Â¥${type.averageRent})\n`;
                        });
                    }
                    
                    resultElement.textContent = content;
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${data.error || 'æ•°æ®æ ¼å¼é”™è¯¯'}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // æµ‹è¯•æƒé™ä¸è¶³
        async function testUnauthorizedAccess() {
            const resultElement = document.getElementById('exceptionTestResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨æµ‹è¯•æƒé™ä¸è¶³æƒ…å†µ...';
                resultElement.className = 'result info';
                
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=guest&dimension=all`
                );
                const data = await response.json();
                
                if (!response.ok && data.error && data.error.includes('æƒé™ä¸è¶³')) {
                    resultElement.textContent = `âœ… æƒé™éªŒè¯æµ‹è¯•é€šè¿‡: ${data.error}`;
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `âŒ æƒé™éªŒè¯æµ‹è¯•å¤±è´¥: åº”è¯¥æ‹’ç»æ— æƒé™ç”¨æˆ·è®¿é—®`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // æµ‹è¯•ç©ºæ•°æ®
        async function testEmptyData() {
            const resultElement = document.getElementById('exceptionTestResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨æµ‹è¯•ç©ºæ•°æ®æƒ…å†µ...';
                resultElement.className = 'result info';
                
                // è¿™é‡Œå¯ä»¥æ¨¡æ‹Ÿç©ºæ•°æ®åº“çš„æƒ…å†µï¼Œæˆ–è€…æ£€æŸ¥æŠ¥è¡¨å¤„ç†ç©ºæ•°æ®çš„é€»è¾‘
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=admin&dimension=all`
                );
                const data = await response.json();
                
                if (response.ok) {
                    let hasData = false;
                    if (data.data.overview && data.data.overview.totalStores > 0) {
                        hasData = true;
                    }
                    
                    if (hasData) {
                        resultElement.textContent = `âœ… ç©ºæ•°æ®å¤„ç†æµ‹è¯•: å½“å‰æœ‰æ•°æ®ï¼ŒæŠ¥è¡¨æ­£å¸¸ç”Ÿæˆ\næ€»åº—é“ºæ•°: ${data.data.overview.totalStores}`;
                        resultElement.className = 'result success';
                    } else {
                        resultElement.textContent = `âœ… ç©ºæ•°æ®å¤„ç†æµ‹è¯•: ç³»ç»Ÿæ­£ç¡®å¤„ç†äº†ç©ºæ•°æ®æƒ…å†µ`;
                        resultElement.className = 'result success';
                    }
                } else {
                    resultElement.textContent = `âŒ ç©ºæ•°æ®æµ‹è¯•å¼‚å¸¸: ${data.error}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // æµ‹è¯•æ— æ•ˆç»´åº¦
        async function testInvalidDimension() {
            const resultElement = document.getElementById('exceptionTestResult');
            
            try {
                resultElement.textContent = 'æ­£åœ¨æµ‹è¯•æ— æ•ˆç»´åº¦å‚æ•°...';
                resultElement.className = 'result info';
                
                const response = await fetch(
                    `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=admin&dimension=invalid_dimension`
                );
                const data = await response.json();
                
                if (response.ok) {
                    // ç³»ç»Ÿåº”è¯¥é»˜è®¤å¤„ç†æ— æ•ˆç»´åº¦ï¼Œå¯èƒ½è¿”å›allç»´åº¦çš„æ•°æ®
                    resultElement.textContent = `âœ… æ— æ•ˆç»´åº¦å¤„ç†æµ‹è¯•: ç³»ç»Ÿé»˜è®¤å¤„ç†æ— æ•ˆç»´åº¦å‚æ•°\nå¤„ç†ç»“æœ: è¿”å›${data.dimension}ç»´åº¦æ•°æ®`;
                    resultElement.className = 'result success';
                } else {
                    resultElement.textContent = `âŒ æ— æ•ˆç»´åº¦æµ‹è¯•: ${data.error}`;
                    resultElement.className = 'result error';
                }
            } catch (error) {
                resultElement.textContent = `âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.className = 'result error';
            }
        }

        // å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
        async function runCompleteWorkflowTest() {
            const resultElement = document.getElementById('workflowTestResult');
            let testResult = 'ğŸš€ å¼€å§‹å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•...\n\n';
            
            try {
                resultElement.textContent = testResult;
                resultElement.className = 'result info';
                
                // æ­¥éª¤1: æ£€æŸ¥åŸºç¡€æ•°æ®
                testResult += 'æ­¥éª¤1: æ£€æŸ¥åŸºç¡€ç»Ÿè®¡æ•°æ®...\n';
                const basicResponse = await fetch(`${API_BASE}/Store/BasicStatistics`);
                const basicData = await basicResponse.json();
                
                if (basicResponse.ok) {
                    testResult += `âœ… æ­¥éª¤1æˆåŠŸ: åŸºç¡€æ•°æ®æ­£å¸¸\n`;
                    testResult += `   - æ€»åº—é“º: ${basicData.totalStores}ä¸ª\n`;
                    testResult += `   - æ­£å¸¸è¥ä¸š: ${basicData.activeStores}ä¸ª\n`;
                    testResult += `   - å…¥ä½ç‡: ${basicData.occupancyRate}%\n\n`;
                    
                    // æ­¥éª¤2: ç”Ÿæˆå„ç»´åº¦æŠ¥è¡¨
                    const dimensions = ['type', 'area', 'status', 'all'];
                    let allSuccess = true;
                    
                    for (const dim of dimensions) {
                        testResult += `æ­¥éª¤2.${dimensions.indexOf(dim) + 1}: ç”Ÿæˆ${getDimensionName(dim)}æŠ¥è¡¨...\n`;
                        
                        const reportResponse = await fetch(
                            `${API_BASE}/Store/MerchantStatisticsReport?operatorAccount=admin&dimension=${dim}`
                        );
                        const reportData = await reportResponse.json();
                        
                        if (reportResponse.ok) {
                            testResult += `âœ… ${getDimensionName(dim)}æŠ¥è¡¨ç”ŸæˆæˆåŠŸ\n`;
                        } else {
                            testResult += `âŒ ${getDimensionName(dim)}æŠ¥è¡¨ç”Ÿæˆå¤±è´¥: ${reportData.error}\n`;
                            allSuccess = false;
                        }
                    }
                    
                    testResult += '\n';
                    
                    if (allSuccess) {
                        testResult += 'ğŸ‰ å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼\n';
                        testResult += 'âœ… åŸºç¡€æ•°æ®æŸ¥è¯¢æ­£å¸¸\n';
                        testResult += 'âœ… å„ç»´åº¦æŠ¥è¡¨ç”Ÿæˆæ­£å¸¸\n';
                        testResult += 'âœ… æƒé™éªŒè¯æ­£å¸¸\n';
                        testResult += 'âœ… æ•°æ®ç»Ÿè®¡å‡†ç¡®\n';
                        resultElement.className = 'result success';
                    } else {
                        testResult += 'âš ï¸ éƒ¨åˆ†æµç¨‹å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥å…·ä½“æ­¥éª¤\n';
                        resultElement.className = 'result error';
                    }
                } else {
                    testResult += `âŒ æ­¥éª¤1å¤±è´¥: ${basicData.error}\n`;
                    resultElement.className = 'result error';
                }
                
                resultElement.textContent = testResult;
                
            } catch (error) {
                testResult += `âŒ æµç¨‹æµ‹è¯•å¼‚å¸¸: ${error.message}`;
                resultElement.textContent = testResult;
                resultElement.className = 'result error';
            }
        }
    </script>
</body>
</html>
